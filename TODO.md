# TODO: Исправление VAD и чанкинга

ЛОКАЛЬНЫЙ PYTHON ДОЛЖЕН ИСПОЛЬЗОВАТЬСЯ,
C:/Users/GOW_PHD/AppData/Local/Programs/Python/Python312/python.exe script.py ilya_6m_test.wav vad_output.txt

## Текущие задачи

### 1. Вынести отдельно VAD

### 2. Вынести отдельно chunking

### 3. Настроить работу chuncking and VAD
  - есть файл для тестирования ilya_6m_test.wav, тренироваться на нём
  - напрямую смотреть файл Ручная разметка его сегментов в txt vad_hand_results_6m.txt:
0.0–43.0 Голос
43.0–47.0 Шум
150.0–155.0 Голос
155.0–162.0 Шум
194.0–197.0 Шум
201.0–213.0 Шум
214.0–219.0 Голос
219.0–226.0 Шум
256.0–259.0 Голос
259.0–263.0 Шум
274.0–286.0 Голос
289.0–296.0 Голос
302.0–304.0 Шум
306.0–309.0 Голос
309.0–312.0 Шум
331.0–340.0 Голос

Остальное — тишина

### Результаты валидации на ilya_6m_test.wav
- Ложноположительные срабатывания (шум/тишина → голос):
  43.0–43.3; 147.5–150.0; 155.0–170.1; 211.6–213.0; 219.0–233.7; 
  254.2–256.0; 259.0–274.0; 286.0–289.0; 296.0–306.0; 309.0–331.0
- Пропущенный сегмент голоса:
  338.6–340.0 (хвостовая часть)

## Стратегия работы

1. **Рефакторинг архитектуры:**
   - Создать `vad_module.py` для Voice Activity Detection:
     - Перенести функции `_silero_vad_segments` и связанные с VAD
     - Реализовать единый интерфейс для выбора метода VAD
   - Создать `chunking_module.py` для сегментации аудио:
     - Перенести функции `slice_into_chunks`, `_compute_energy_envelope`, `_find_cut_near`
     - Реализовать адаптер для интеграции с VAD модулем

2. **Интеграция модулей:**
   - Модифицировать `inference_gigaam.py` для использования новых модулей
   - Реализовать конфигурационный механизм для выбора методов обработки

3. **Тестирование и валидация:**
   - Использовать `ilya_6m_test.wav` как тестовый пример
   - Реализовать вывод результатов в формате:
     ```
     [start]-[end] [тип сегмента]
     ```
   - Сохранять результаты в `transcript_results.txt` для сравнения с `vad_hand_results_6m.txt`
   - Пример команды для генерации отчёта с использованием локального Python:
     ```bash
     C:/Users/GOW_PHD/AppData/Local/Programs/Python/Python312/python.exe inference_gigaam.py ilya_6m_test.wav output.json --output_format txt --output_report transcript_results.txt
     ```
   - Команда для сравнения с ручной разметкой:
     ```bash
     diff -y transcript_results.txt vad_hand_results_6m.txt
     ```

4. **Документирование:**
   - Добавить docstrings во все модули
   - Создать README с инструкцией по использованию
   - Описать процесс валидации результатов

5. **Оптимизация:**
   - Профилирование производительности
   - Оптимизация использования памяти GPU

## Прогресс выполнения
- [x] Создание модуля VAD
- [x] Создание модуля chunking
- [x] Интеграция модулей в основной скрипт
- [x] Тестирование на ilya_6m_test.wav
- [x] Реализация форматированного вывода для сравнения
- [x] Добавление инструкции по ручному сравнению
- [x] Документирование решения (основные части)
- [ ] Оптимизация параметров VAD
- [ ] Улучшение обработки хвостовых сегментов
- [ ] Автоматизация валидации
